<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>编辑商品</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <!-- load css -->
    <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" media="all">
    <link rel="stylesheet" type="text/css" href="css/font/iconfont.css?v=1.0.0" media="all">
    <link rel="stylesheet" type="text/css" href="css/layui.css" media="all">
    <link rel="stylesheet" type="text/css" href="css/main.css?v2.2.1" media="all">
    <link rel="stylesheet" href="js/lib/upload/control/css/zyUpload.css?v=5" type="text/css">
    <style>
        .layui-table td, .layui-table th {
            padding: 12px 8px;
        }
    </style>
</head>
<body>
<div class="container-fluid larry-wrapper">
    <div class="col-xs-10 col-sm-10 col-md-10" id="page">

    </div>

</div>
<script id="type-tpl" type="text/html"
        data-params='{"url":"/f/web/dicList?type=goodsType","tplid":"type-tpl","listid":"goodsType","loading":false,"pageid":""}'>
    <select name="goodsType" jq-verify="required" lay-filter="verify" disabled>
        {{# layui.each(d.list, function(index, item){ }}
        <option value="{{item.value}}" {{# if(item.label==data.goodsTypeStr){}}selected{{#}}}>{{item.label}}</option>
        {{# }); }}
    </select>
</script>
<script id="label-tpl" type="text/html"
        data-params='{"url":"/f/web/dicList?type=goodsLabel","tplid":"label-tpl","listid":"goodsLabel","loading":false,"pageid":""}'>
    <select name="label">
        <option value="100">请选择商品标签</option>
        <option value="100" >无标签</option>
        {{# layui.each(d.list, function(index, item){ }}
        <option value="{{item.value}}" {{# if(item.label==data.label){}}selected{{#}}}>{{item.label}}</option>
        {{# }); }}
    </select>
</script>
<!--<script type="text/html" id="goodsType2">-->
    <!--<div class="layui-form-item">-->
        <!--<label class="layui-form-label">充值折扣</label>-->
        <!--<div class="layui-input-block">-->
            <!--<input type="text" name="discount" placeholder="请输入充值折扣" value="{{data.discount}}" autocomplete="off" required-->
                   <!--jq-verify="required" jq-error="请输入充值折扣"-->
                   <!--class="layui-input ">-->
        <!--</div>-->
    <!--</div>-->
    <!--<div class="layui-form-item">-->
        <!--<label class="layui-form-label">商品周期</label>-->
        <!--<div class="layui-input-block">-->
            <!--<input type="text" name="cycle" placeholder="请输入商品周期" autocomplete="off" value="{{data.cycle}}" required-->
                   <!--jq-verify="required" jq-error="请输入商品周期"-->
                   <!--class="layui-input ">-->
        <!--</div>-->
    <!--</div>-->
    <!--<div class="layui-form-item">-->
        <!--<label class="layui-form-label">活动折扣</label>-->
        <!--<div class="layui-input-block">-->
            <!--<input type="text" name="activityDiscount" placeholder="请输入活动折扣" value="{{data.activityDiscount}}" autocomplete="off" required-->
                   <!--jq-verify="required" jq-error="请输入活动折扣"-->
                   <!--class="layui-input ">-->
        <!--</div>-->
    <!--</div>-->
<!--</script>-->
<!--<script type="text/html" id="goodsType1">-->
    <!--<div class="layui-form-item">-->
        <!--<label class="layui-form-label">商品价格</label>-->
        <!--<div class="layui-input-block">-->
            <!--<input type="text" name="prices" placeholder="请输入商品价格" value="{{data.prices}}" autocomplete="off" required-->
                   <!--jq-verify="required" jq-error="请输入商品价格"-->
                   <!--class="layui-input ">-->
        <!--</div>-->
    <!--</div>-->
    <!--<div class="layui-form-item">-->
        <!--<label class="layui-form-label">商品价值</label>-->
        <!--<div class="layui-input-block">-->
            <!--<input type="text" name="val" placeholder="请输入商品价值" value="{{data.val}}" autocomplete="off" required-->
                   <!--jq-verify="required" jq-error="请输入商品价值"-->
                   <!--class="layui-input ">-->
        <!--</div>-->
    <!--</div>-->
    <!--<div class="layui-form-item">-->
        <!--<label class="layui-form-label">折扣价值</label>-->
        <!--<div class="layui-input-block">-->
            <!--<input type="text" name="discountMoney" placeholder="请输入商品价值" value="{{data.discountMoney}}" autocomplete="off" required-->
                   <!--jq-verify="required" jq-error="请输入商品价值"-->
                   <!--class="layui-input ">-->
        <!--</div>-->
    <!--</div>-->
<!--</script>-->
<script type="text/javascript" src="js/layui/layui.js"></script>
<script type="text/javascript" src="js/config.js"></script>
<script type="text/javascript" src="js/lib/jquery-2.2.0.min.js"></script>
<script id="page-tpl" type="text/html">
    {{# data = d.hykGoods }}
    <form id="addForm" class="layui-form layui-form-pane" action="/f/web/hykGoods/save" method="post"
          complete="add">
        <div class="layui-form-item">
            <label class="layui-form-label">商品类型</label>
            <div class="layui-input-inline" id="goodsType">

            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">商品名称</label>
            <div class="layui-input-block">
                <input type="text" name="goodsName" placeholder="请输入商品名称" value="{{data.goodsName}}" autocomplete="off"  required
                       jq-verify="required" jq-error="请输入商品名称"
                       class="layui-input ">
            </div>
        </div>
        <!--套餐-->
        <div class="goodsTypebox">
            {{#if(data.goodsTypeStr=='充值套餐'){}}
            <div class="layui-form-item">
                <label class="layui-form-label">充值折扣</label>
                <div class="layui-input-block">
                    <input type="text" name="discount" placeholder="请输入充值折扣(如7.8 = 78%)" value="{{data.discount}}" jq-verify="required|acount" autocomplete="off" required class="layui-input ">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">活动折扣</label>
                <div class="layui-input-block">
                    <input type="text" name="activityDiscount" placeholder="请输入活动折扣(如无活动折扣请填写充值折扣)" value="{{data.activityDiscount}}" jq-verify="required|activityAcount" autocomplete="off" required class="layui-input ">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">推荐金额1</label>
                <div class="layui-input-block">
                    <input type="text" name="adviceMoney1" placeholder="请输入推荐金额1" value="{{data.adviceMoney1}}"  autocomplete="off" class="layui-input ">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">推荐金额2</label>
                <div class="layui-input-block">
                    <input type="text" name="adviceMoney2" placeholder="请输入推荐金额2" value="{{data.adviceMoney2}}"  autocomplete="off" class="layui-input ">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">商品周期</label>
                <div class="layui-input-inline">
                    <select name="cycle" jq-verify="required" jq-error="请选择商品周期" disabled>
                        <option value="">请选择商品周期</option>
                        {{# for(var i=1;i<=24;i++){ }}
                        <option value="{{i}}" {{# if(data.cycle==i){}}selected{{#}}}>{{i}}个月</option>
                        {{# }}}
                    </select>
                </div>
            </div>
            {{#}else{}}
            <div class="layui-form-item">
                <label class="layui-form-label">商品价值</label>
                <div class="layui-input-block">
                    <input type="text" name="val" placeholder="请输入商品价值" value="{{data.val}}" autocomplete="off" required jq-verify="required|goodsPrice" class="layui-input ">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">商品价格</label>
                <div class="layui-input-block">
                    <input type="text" name="prices" placeholder="请输入商品价格" value="{{data.prices}}" autocomplete="off" required jq-verify="required|goodsPrice|maxd" class="layui-input ">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">活动价格</label>
                <div class="layui-input-block">
                    <input type="text" name="discountMoney" placeholder="请输入活动价格(如无活动请填写商品价格)" required jq-verify="required|goodsPrice|mind" value="{{data.discountMoney}}" autocomplete="off"  class="layui-input ">
                </div>
            </div>
            <input type="hidden" name="cycle" value="1">
            {{#}}}
        </div>
        <!--即时充值-->
        <div class="layui-form-item">
            <label class="layui-form-label">商品库存</label>
            <div class="layui-input-block">
                <input type="text" name="stock" placeholder="请输入商品库存" value="{{data.stock}}" autocomplete="off" required
                       jq-verify="required|number" jq-error="请输入正确库存"
                       class="layui-input ">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">商品图片</label>
            <div class="layui-input-block">
                <div class="layui-btn layui-btn-warm modal-iframe" data-params='{"content":"upload.html?name=goodsImg", "title":"上传图片", "area":"520px,350px"}'>
                    <i class="iconfont">&#xe63c;</i>上传图片
                </div>
                {{#if(data.goodsImg!=''){}}
                <div class="layui-btn layui-btn-danger" onclick="deleteImg('goodsImg',this)">
                    <i class="iconfont">&#xe607;</i>删除图片
                </div>
                {{#}}}
                <input type="hidden" name="goodsImg" value="{{data.goodsImg}}">
                {{#if(data.goodsImg!=''){}}
                <div class="goodsImg imgView">
                    <img src="{{data.goodsImg}}" style="width:auto;height:130px;">
                </div>
                {{#}}}
            </div>
            <div class="layui-clear"></div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">商品标签</label>
            <div class="layui-input-inline" id="goodsLabel">

            </div>
        </div>
        <input type="hidden" name="token" value="{{token}}">
        <input type="hidden" name="id" value="{{id}}">
        <div class="layui-form-item hyk_buttons">
            <div class="layui-input-block">
                <button class="layui-btn layui-btn-submit" jq-submit jq-filter="submit">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>

</script>
<script>

    var list,
        id,
        data=[];
    layui.use(['jqform', 'dtable','form'], function () {
        list = layui.dtable;
        var  oneList = new list();
        id = oneList.getUrlParam('id');
        $('#page-tpl').attr('data-params', '{"url":"/f/web/hykGoods/getId?id=' + id + '","loading":"false","tplid":"page-tpl","listid":"page","complete":"loaded"}');
        oneList.init('page-tpl');
    });
    function deleteImg(name,dom){
        $(dom).remove()
        $('.'+name+'').html('');
        $('input[name='+name+']').val('');
    }
    function loaded(res){
        layui.use(['form','laytpl'],function(){
            var oneList = new list(),
                tpl = layui.laytpl,
                form = layui.jqform,
                reg=/[^\d^\.]+/g,
                reg2=/^\d+$/,
                forms = layui.form();
            oneList.init('type-tpl');
            oneList.init('label-tpl');
            forms.on('select(verify)', function (data) {
                if(data.value==1){
                    var getTpl = $('#goodsType1').html();
                    tpl(getTpl).render(data, function (html) {
                        $('.goodsTypebox').html(html);
                    });
                }else{
                    var getTpl2 = $('#goodsType2').html();
                    tpl(getTpl2).render(data, function (html) {
                        $('.goodsTypebox').html(html);
                    })
                }
            })
            form.verify({
                acount: function(value) {
                    if(reg.test(value)){
                        return '请输入正确的折扣'
                    }
                    if(value<=0 || value>10){
                        return '折扣范围为0.1-10'
                    }
                },
                activityAcount:function(value){
                    var max = $('input[name=discount]').val()
                    if(reg.test(value)){
                        return '请输入正确的折扣'
                    }
                    if(+value>+max){
                        return '活动折扣不能大于充值折扣'
                    }
                    if(+value<=0 || +value>10){
                        return '折扣范围为0.1-10'
                    }
                },
                goodsPrice:function(value){
                    if(!reg2.test(value)){
                        return '请输入正确的价格'
                    }
                    if(+value<=0){
                        return '不能为0'
                    }
                },
                maxd:function(value){
                    var jiazhi = $('input[name=val]').val()
                    if(+value>+jiazhi){
                        return '商品价格不能大于商品价值'
                    }
                },
                mind:function(value){
                    var jiage = $('input[name=prices]').val()
                    if(+value>+jiage){
                        return '活动价格不能大于商品价格'
                    }
                }
            });
        })
    }
    function add(res) {
        layer.msg('商品已修改', {
            time: 1000, shade: [0.2, '#fff']
        }, function () {
            var index = parent.layer.getFrameIndex(window.name);
            parent.layer.close(index);
            var oneList = new parent.layui.dtable();
            oneList.init('list-tpl');
            oneList.init('goods-tpl');
        });
    }
</script>
</body>
</html>
